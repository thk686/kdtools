<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with kdtools â€¢ kdtools</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with kdtools">
<meta property="og:description" content="kdtools">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">kdtools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/kdtools.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/methods.html">Compact multidimensional sorting and searching with kdtools</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/thk686/kdtools/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="kdtools_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with kdtools</h1>
                        <h4 class="author">Timothy H. Keitt</h4>
            
            <h4 class="date">2021-08-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/thk686/kdtools/blob/master/vignettes/kdtools.Rmd"><code>vignettes/kdtools.Rmd</code></a></small>
      <div class="hidden name"><code>kdtools.Rmd</code></div>

    </div>

    
    
<p>There are now two options for using kdtools, either on a C++ vector of arrays (arrayvec object) or natively on a data frame. Sorting on arrayvec objects is fast. Passing a data frame is slower, but automatically supports mixed types.</p>
<div id="data-frame-interface" class="section level3">
<h3 class="hasAnchor">
<a href="#data-frame-interface" class="anchor"></a>Data Frame Interface</h3>
<div id="step-1--sort-data-frame" class="section level5">
<h5 class="hasAnchor">
<a href="#step-1--sort-data-frame" class="anchor"></a>Step 1. Sort data frame</h5>
<p>When working with a data frame, you can specify which columns to use and the order of inclusion using the <code>cols</code> argument. Omitting the <code>cols</code> argument uses all columns in order.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># sort by weight, miles-per-gallon and displacement</span>
<span class="va">mtcars_sorted</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kd_sort.html">kd_sort</a></span><span class="op">(</span><span class="va">mtcars</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>;
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mtcars_sorted</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;                mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#&gt; Toyota Corona 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1</span>
<span class="co">#&gt; Datsun 710    22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1</span>
<span class="co">#&gt; Ferrari Dino  19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">tail</a></span><span class="op">(</span><span class="va">mtcars_sorted</span>, <span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt;                    mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#&gt; Hornet Sportabout 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2</span>
<span class="co">#&gt; Merc 450SL        17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3</span>
<span class="co">#&gt; Pontiac Firebird  19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2</span></code></pre></div>
</div>
<div id="step-2--search-sorted-data-frame" class="section level5">
<h5 class="hasAnchor">
<a href="#step-2--search-sorted-data-frame" class="anchor"></a>Step 2. Search sorted data frame</h5>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lower</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">17</span>, <span class="fl">120</span><span class="op">)</span>
<span class="va">upper</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.6</span>, <span class="fl">22</span>, <span class="fl">330</span><span class="op">)</span>
<span class="fu"><a href="../reference/kd_lower_bound.html">kd_range_query</a></span><span class="op">(</span><span class="va">mtcars_sorted</span>, <span class="va">lower</span>, <span class="va">upper</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#&gt; Ferrari Dino   19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6</span>
<span class="co">#&gt; Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</span>
<span class="co">#&gt; Mazda RX4      21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4</span>
<span class="co">#&gt; Mazda RX4 Wag  21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4</span>
<span class="co">#&gt; Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1</span>
<span class="co">#&gt; Merc 280C      17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4</span>
<span class="co">#&gt; Merc 280       19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4</span>
<span class="co">#&gt; Valiant        18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1</span>
<span class="fu"><a href="../reference/kd_nearest_neighbors.html">kd_nearest_neighbors</a></span><span class="op">(</span><span class="va">mtcars_sorted</span>, <span class="va">lower</span>, <span class="fl">2</span>, cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;                mpg cyl  disp  hp drat    wt  qsec vs am gear carb</span>
<span class="co">#&gt; Volvo 142E    21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2</span>
<span class="co">#&gt; Toyota Corona 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1</span></code></pre></div>
</div>
</div>
<div id="arrayvec-interface" class="section level3">
<h3 class="hasAnchor">
<a href="#arrayvec-interface" class="anchor"></a>Arrayvec Interface</h3>
<p>The kdtools package can be used to search for multidimensional points in a boxed region and find nearest neighbors in 1 to 9 dimensions. The package uses binary search on a sorted sequence of values. The current package is limited to matrices of real values. If you are interested in using string or mixed types in different dimensions, see the methods vignette.</p>
<p>Using kdtools is straightforward. There are four steps:</p>
<div id="step-1--convert-your-matrix-of-values-into-a-arrayvec-object" class="section level5">
<h5 class="hasAnchor">
<a href="#step-1--convert-your-matrix-of-values-into-a-arrayvec-object" class="anchor"></a>Step 1. Convert your matrix of values into a arrayvec object</h5>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/thk686/kdtools">kdtools</a></span><span class="op">)</span>
<span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">3e3</span><span class="op">)</span>, nc <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="va">y</span> <span class="op">=</span> <span class="fu"><a href="../reference/matrix_to_tuples.html">matrix_to_tuples</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
<span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;           [,1]      [,2]</span>
<span class="co">#&gt; [1,] 0.5480358 0.5711746</span>
<span class="co">#&gt; [2,] 0.2882401 0.9518475</span>
<span class="co">#&gt; [3,] 0.6901510 0.9401036</span></code></pre></div>
<p>The arrayvec object can be manipulated as if it were a matrix.</p>
</div>
<div id="step-2--sort-the-data" class="section level5">
<h5 class="hasAnchor">
<a href="#step-2--sort-the-data" class="anchor"></a>Step 2. Sort the data</h5>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/kd_sort.html">kd_sort</a></span><span class="op">(</span><span class="va">y</span>, inplace <span class="op">=</span> <span class="cn">TRUE</span>, parallel <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt;             [,1]       [,2]       [,3]</span>
<span class="co">#&gt; [1,] 0.144919157 0.01594060 0.04085223</span>
<span class="co">#&gt; [2,] 0.075208274 0.02600779 0.06511737</span>
<span class="co">#&gt; [3,] 0.119023805 0.15165066 0.18930912</span>
<span class="co">#&gt; [4,] 0.002236085 0.17240400 0.07535075</span>
<span class="co">#&gt; [5,] 0.063678891 0.24544083 0.07171674</span>
<span class="co">#&gt; (continues for 995 more rows)</span></code></pre></div>
</div>
<div id="step-3--search-the-data" class="section level5">
<h5 class="hasAnchor">
<a href="#step-3--search-the-data" class="anchor"></a>Step 3. Search the data</h5>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">rq</span> <span class="op">=</span> <span class="fu"><a href="../reference/kd_lower_bound.html">kd_range_query</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">4</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span>; <span class="va">rq</span>
<span class="co">#&gt;             [,1]       [,2]       [,3]</span>
<span class="co">#&gt; [1,] 0.144919157 0.01594060 0.04085223</span>
<span class="co">#&gt; [2,] 0.075208274 0.02600779 0.06511737</span>
<span class="co">#&gt; [3,] 0.119023805 0.15165066 0.18930912</span>
<span class="co">#&gt; [4,] 0.002236085 0.17240400 0.07535075</span>
<span class="co">#&gt; [5,] 0.063678891 0.24544083 0.07171674</span>
<span class="co">#&gt; (continues for 11 more rows)</span>
<span class="va">i</span> <span class="op">=</span> <span class="fu"><a href="../reference/kd_nearest_neighbors.html">kd_nearest_neighbor</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>; <span class="va">y</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span>
<span class="co">#&gt; [1] 0.07520827 0.02600779 0.06511737</span>
<span class="va">nns</span> <span class="op">=</span> <span class="fu"><a href="../reference/kd_nearest_neighbors.html">kd_nearest_neighbors</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">100</span><span class="op">)</span>; <span class="va">nns</span>
<span class="co">#&gt;           [,1]      [,2]      [,3]</span>
<span class="co">#&gt; [1,] 0.3431665 0.2926172 0.3222193</span>
<span class="co">#&gt; [2,] 0.3684279 0.3683356 0.1886035</span>
<span class="co">#&gt; [3,] 0.3486034 0.1694306 0.3900136</span>
<span class="co">#&gt; [4,] 0.3052376 0.4321093 0.1413894</span>
<span class="co">#&gt; [5,] 0.3705080 0.3083208 0.2569798</span>
<span class="co">#&gt; (continues for 95 more rows)</span>
<span class="va">nni</span> <span class="op">=</span> <span class="fu"><a href="../reference/kd_nearest_neighbors.html">kd_nn_indices</a></span><span class="op">(</span><span class="va">y</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>; <span class="va">nni</span>
<span class="co">#&gt;  [1]  3  9  7  5  6 10 11  4  1  2</span></code></pre></div>
<p>The <code>kd_nearest_neighbor</code> and <code>kd_nn_indices</code> functions return row-indices. The other functions return arrayvec objects.</p>
</div>
<div id="step-4--convert-back-to-a-matrix-for-use-in-r" class="section level5">
<h5 class="hasAnchor">
<a href="#step-4--convert-back-to-a-matrix-for-use-in-r" class="anchor"></a>Step 4. Convert back to a matrix for use in R</h5>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/matrix_to_tuples.html">tuples_to_matrix</a></span><span class="op">(</span><span class="va">rq</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;             [,1]       [,2]       [,3]</span>
<span class="co">#&gt; [1,] 0.144919157 0.01594060 0.04085223</span>
<span class="co">#&gt; [2,] 0.075208274 0.02600779 0.06511737</span>
<span class="co">#&gt; [3,] 0.119023805 0.15165066 0.18930912</span>
<span class="co">#&gt; [4,] 0.002236085 0.17240400 0.07535075</span>
<span class="co">#&gt; [5,] 0.063678891 0.24544083 0.07171674</span>
<span class="co">#&gt; [6,] 0.014158307 0.19532744 0.12891683</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fu"><a href="../reference/matrix_to_tuples.html">tuples_to_matrix</a></span><span class="op">(</span><span class="va">nns</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;           [,1]      [,2]      [,3]</span>
<span class="co">#&gt; [1,] 0.3431665 0.2926172 0.3222193</span>
<span class="co">#&gt; [2,] 0.3684279 0.3683356 0.1886035</span>
<span class="co">#&gt; [3,] 0.3486034 0.1694306 0.3900136</span>
<span class="co">#&gt; [4,] 0.3052376 0.4321093 0.1413894</span>
<span class="co">#&gt; [5,] 0.3705080 0.3083208 0.2569798</span>
<span class="co">#&gt; [6,] 0.2518356 0.4669241 0.1252029</span></code></pre></div>
<p>If you pass a matrix instead of an arrayvec object to any of the functions, it will be converted to an arrayvec object internally and results will be returned as matrices. This is slower and provided for convenience.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Timothy Keitt.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
